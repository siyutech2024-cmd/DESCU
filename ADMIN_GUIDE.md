# DESCU ç®¡ç†å‘˜åå°ä½¿ç”¨æ–‡æ¡£

## ğŸ“š ç›®å½•
- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ•°æ®åº“è®¾ç½®](#æ•°æ®åº“è®¾ç½®)
- [ç®¡ç†å‘˜è´¦å·è®¾ç½®](#ç®¡ç†å‘˜è´¦å·è®¾ç½®)
- [åŠŸèƒ½ä½¿ç”¨](#åŠŸèƒ½ä½¿ç”¨)
- [APIæ¥å£](#apiæ¥å£)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¦‚è¿°

DESCUç®¡ç†å‘˜åå°æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„åå°ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºç®¡ç†DESCUäºŒæ‰‹äº¤æ˜“å¹³å°çš„æ‰€æœ‰æ•°æ®å’Œè¿è¥ã€‚

### ä¸»è¦åŠŸèƒ½
- ğŸ“Š **ä»ªè¡¨æ¿**: å®æ—¶ç»Ÿè®¡æ•°æ®å’Œå…³é”®æŒ‡æ ‡
- ğŸ›ï¸ **å•†å“ç®¡ç†**: å®Œæ•´çš„CRUDæ“ä½œï¼ŒçŠ¶æ€ç®¡ç†ï¼Œæ¨å¹¿è®¾ç½®
- ğŸ‘¥ **ç”¨æˆ·ç®¡ç†**: ç”¨æˆ·è®¤è¯ï¼Œå°ç¦ç®¡ç†
- ğŸ’¬ **æ¶ˆæ¯ç›‘æ§**: å¯¹è¯ç›‘æ§ï¼Œè¿è§„å†…å®¹ç®¡ç†
- ğŸ“ˆ **æ•°æ®æŠ¥è¡¨**: ç»Ÿè®¡åˆ†æå’Œæ•°æ®å¯¼å‡º

### æŠ€æœ¯æ ˆ
- å‰ç«¯: React + TypeScript + Vite
- åç«¯: Node.js + Express
- æ•°æ®åº“: Supabase (PostgreSQL)
- è®¤è¯: Supabase Auth (Google OAuth)

---

## å¿«é€Ÿå¼€å§‹

### 1. æ•°æ®åº“è¿ç§»

é¦–å…ˆï¼Œè¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬åˆ›å»ºå¿…è¦çš„è¡¨å’Œè§†å›¾ï¼š

1. ç™»å½•åˆ°æ‚¨çš„[Supabase Dashboard](https://supabase.com/dashboard)
2. è¿›å…¥æ‚¨çš„é¡¹ç›®
3. ç‚¹å‡»å·¦ä¾§èœå•çš„ **SQL Editor**
4. æ‰“å¼€é¡¹ç›®ä¸­çš„ `server/admin-migration.sql` æ–‡ä»¶
5. å¤åˆ¶æ‰€æœ‰å†…å®¹å¹¶ç²˜è´´åˆ°SQLç¼–è¾‘å™¨
6. ç‚¹å‡» **Run** æ‰§è¡Œè„šæœ¬

### 2. å®‰è£…ä¾èµ–

ç¡®ä¿å·²å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š

```bash
# å®‰è£…å‰ç«¯ä¾èµ–
npm install

# å®‰è£…åç«¯ä¾èµ–
cd server
npm install
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯æœåŠ¡ï¼ˆåœ¨serverç›®å½•ï¼‰
cd server
npm run dev

# å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆåœ¨æ ¹ç›®å½•ï¼‰
npm run dev
```

### 4. è®¿é—®ç®¡ç†åå°

è®¿é—® `http://localhost:5173/admin/login` è¿›å…¥ç®¡ç†åå°ç™»å½•é¡µé¢

---

## ç®¡ç†å‘˜è´¦å·è®¾ç½®

### æ–¹å¼ä¸€ï¼šé€šè¿‡Supabase Dashboardè®¾ç½®

1. ç™»å½• [Supabase Dashboard](https://supabase.com/dashboard)
2. è¿›å…¥æ‚¨çš„é¡¹ç›®
3. ç‚¹å‡»å·¦ä¾§èœå•çš„ **Authentication** â†’ **Users**
4. æ‰¾åˆ°è¦è®¾ç½®ä¸ºç®¡ç†å‘˜çš„ç”¨æˆ·
5. ç‚¹å‡»ç”¨æˆ·è¿›å…¥è¯¦æƒ…é¡µ
6. åœ¨ **User Metadata** éƒ¨åˆ†ï¼Œç‚¹å‡» **Edit**
7. æ·»åŠ ä»¥ä¸‹å…ƒæ•°æ®ï¼š

```json
{
  "role": "admin",
  "permissions": ["all"]
}
```

æˆ–è®¾ç½®ä¸ºè¶…çº§ç®¡ç†å‘˜ï¼š

```json
{
  "role": "super_admin",
  "permissions": ["all"]
}
```

8. ç‚¹å‡» **Save** ä¿å­˜

### æ–¹å¼äºŒï¼šé€šè¿‡SQLè®¾ç½®

åœ¨Supabase SQL Editorä¸­è¿è¡Œï¼š

```sql
-- å°†ç‰¹å®šç”¨æˆ·è®¾ç½®ä¸ºç®¡ç†å‘˜
UPDATE auth.users
SET raw_user_meta_data = jsonb_set(
  COALESCE(raw_user_meta_data, '{}'::jsonb),
  '{role}',
  '"admin"'
)
WHERE email = 'ä½ çš„ç®¡ç†å‘˜é‚®ç®±@example.com';

-- è®¾ç½®æƒé™
UPDATE auth.users
SET raw_user_meta_data = jsonb_set(
  raw_user_meta_data,
  '{permissions}',
  '["all"]'::jsonb
)
WHERE email = 'ä½ çš„ç®¡ç†å‘˜é‚®ç®±@example.com';
```

---

## åŠŸèƒ½ä½¿ç”¨

### ä»ªè¡¨æ¿ (Dashboard)

è®¿é—®è·¯å¾„: `/admin/dashboard`

#### åŠŸèƒ½è¯´æ˜
- **ç»Ÿè®¡å¡ç‰‡**: æ˜¾ç¤ºå•†å“ã€ç”¨æˆ·ã€æ¶ˆæ¯ã€å¯¹è¯çš„æ€»æ•°å’Œä»Šæ—¥æ–°å¢
- **7å¤©è¶‹åŠ¿å›¾**: å±•ç¤ºæœ€è¿‘7å¤©çš„å•†å“å‘å¸ƒè¶‹åŠ¿
- **åˆ†ç±»åˆ†å¸ƒ**: å„å•†å“åˆ†ç±»çš„å æ¯”
- **æœ€æ–°å•†å“**: æœ€è¿‘å‘å¸ƒçš„å•†å“åˆ—è¡¨

### å•†å“ç®¡ç†

è®¿é—®è·¯å¾„: `/admin/products`

#### å¯ç”¨æ“ä½œ
1. **æŸ¥çœ‹å•†å“åˆ—è¡¨**: åˆ†é¡µæµè§ˆæ‰€æœ‰å•†å“
2. **æœç´¢å•†å“**: æŒ‰æ ‡é¢˜ã€å–å®¶æœç´¢
3. **ç­›é€‰å•†å“**: æŒ‰åˆ†ç±»ã€çŠ¶æ€ã€æ¨å¹¿çŠ¶æ€ç­›é€‰
4. **ç¼–è¾‘å•†å“**: ä¿®æ”¹å•†å“ä¿¡æ¯
5. **åˆ é™¤å•†å“**: è½¯åˆ é™¤å•†å“ï¼ˆå¯æ¢å¤ï¼‰
6. **æ›´æ”¹çŠ¶æ€**: è®¾ç½®ä¸ºæ´»è·ƒã€éæ´»è·ƒæˆ–å¾…å®¡æ ¸
7. **æ¨å¹¿å•†å“**: è®¾ç½®æˆ–å–æ¶ˆå•†å“æ¨å¹¿
8. **æ‰¹é‡æ“ä½œ**: æ‰¹é‡åˆ é™¤ã€æ¿€æ´»ã€æ¨å¹¿å•†å“

#### APIç¤ºä¾‹

```typescript
// è·å–å•†å“åˆ—è¡¨
const result = await adminApi.getProducts({
  page: 1,
  limit: 20,
  category: 'electronics',
  status: 'active'
});

// æ›´æ–°å•†å“çŠ¶æ€
await adminApi.updateProductStatus(productId, 'inactive');

// è®¾ç½®æ¨å¹¿
await adminApi.updateProductPromotion(productId, true);
```

### ç”¨æˆ·ç®¡ç†

è®¿é—®è·¯å¾„: `/admin/users`

#### å¯ç”¨æ“ä½œ
1. **æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨**: æµè§ˆæ‰€æœ‰ç”¨æˆ·
2. **æœç´¢ç”¨æˆ·**: æŒ‰å§“åã€é‚®ç®±æœç´¢
3. **æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…**: æŸ¥çœ‹ç”¨æˆ·èµ„æ–™ã€å‘å¸ƒçš„å•†å“ã€å‚ä¸çš„å¯¹è¯
4. **è®¤è¯ç”¨æˆ·**: è®¾ç½®æˆ–å–æ¶ˆç”¨æˆ·è®¤è¯æ ‡è®°
5. **åˆ é™¤ç”¨æˆ·**: è½¯åˆ é™¤æˆ–ç¡¬åˆ é™¤ç”¨æˆ·åŠå…¶æ‰€æœ‰æ•°æ®

#### APIç¤ºä¾‹

```typescript
// è·å–ç”¨æˆ·åˆ—è¡¨
const result = await adminApi.getUsers({
  page: 1,
  limit: 20,
  search: 'john'
});

// è®¤è¯ç”¨æˆ·
await adminApi.updateUserVerification(userId, true);

// åˆ é™¤ç”¨æˆ·ï¼ˆè½¯åˆ é™¤ï¼‰
await adminApi.deleteUser(userId, false);
```

### æ¶ˆæ¯ç›‘æ§

è®¿é—®è·¯å¾„: `/admin/messages`

#### å¯ç”¨æ“ä½œ
1. **æŸ¥çœ‹å¯¹è¯åˆ—è¡¨**: æµè§ˆæ‰€æœ‰ç”¨æˆ·å¯¹è¯
2. **æŸ¥çœ‹å¯¹è¯è¯¦æƒ…**: æŸ¥çœ‹å®Œæ•´çš„èŠå¤©è®°å½•
3. **åˆ é™¤å¯¹è¯**: åˆ é™¤æ•´ä¸ªå¯¹è¯
4. **åˆ é™¤æ¶ˆæ¯**: åˆ é™¤ç‰¹å®šæ¶ˆæ¯
5. **æ ‡è®°è¿è§„**: æ ‡è®°è¿è§„æ¶ˆæ¯å¹¶è®°å½•åŸå› 

#### APIç¤ºä¾‹

```typescript
// è·å–å¯¹è¯åˆ—è¡¨
const result = await adminApi.getConversations({
  page: 1,
  limit: 20,
  product_id: 'xxx'
});

// æ ‡è®°è¿è§„æ¶ˆæ¯
await adminApi.flagMessage(messageId, true, 'åŒ…å«è¿è§„å†…å®¹');
```

---

## APIæ¥å£

### è®¤è¯

æ‰€æœ‰ç®¡ç†APIéƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«è®¤è¯Tokenï¼š

```
Authorization: Bearer <supabase_access_token>
```

### ç«¯ç‚¹åˆ—è¡¨

#### ä»ªè¡¨æ¿
- `GET /api/admin/dashboard/stats` - è·å–ç»Ÿè®¡æ•°æ®
- `GET /api/admin/auth/me` - è·å–å½“å‰ç®¡ç†å‘˜ä¿¡æ¯
- `GET /api/admin/logs` - è·å–æ“ä½œæ—¥å¿—

#### å•†å“ç®¡ç†
- `GET /api/admin/products` - è·å–å•†å“åˆ—è¡¨
- `GET /api/admin/products/:id` - è·å–å•†å“è¯¦æƒ…
- `PUT /api/admin/products/:id` - æ›´æ–°å•†å“
- `DELETE /api/admin/products/:id` - åˆ é™¤å•†å“
- `POST /api/admin/products/:id/restore` - æ¢å¤å•†å“
- `PATCH /api/admin/products/:id/status` - æ›´æ–°çŠ¶æ€
- `PATCH /api/admin/products/:id/promote` - è®¾ç½®æ¨å¹¿
- `POST /api/admin/products/batch` - æ‰¹é‡æ“ä½œ

#### ç”¨æˆ·ç®¡ç†
- `GET /api/admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `GET /api/admin/users/:id` - è·å–ç”¨æˆ·è¯¦æƒ…
- `PATCH /api/admin/users/:id/verify` - è®¤è¯ç”¨æˆ·
- `DELETE /api/admin/users/:id` - åˆ é™¤ç”¨æˆ·

#### æ¶ˆæ¯ç®¡ç†
- `GET /api/admin/conversations` - è·å–å¯¹è¯åˆ—è¡¨
- `GET /api/admin/conversations/:id` - è·å–å¯¹è¯è¯¦æƒ…
- `DELETE /api/admin/conversations/:id` - åˆ é™¤å¯¹è¯
- `DELETE /api/admin/messages/:id` - åˆ é™¤æ¶ˆæ¯
- `PATCH /api/admin/messages/:id/flag` - æ ‡è®°æ¶ˆæ¯

---

## å¸¸è§é—®é¢˜

### Q: ç™»å½•åæ˜¾ç¤º"æƒé™ä¸è¶³"ï¼Ÿ
A: è¯·ç¡®ä¿æ‚¨çš„ç”¨æˆ·è´¦å·å·²åœ¨Supabaseä¸­è®¾ç½®ä¸ºç®¡ç†å‘˜è§’è‰²ã€‚å‚è€ƒ[ç®¡ç†å‘˜è´¦å·è®¾ç½®](#ç®¡ç†å‘˜è´¦å·è®¾ç½®)éƒ¨åˆ†ã€‚

### Q: APIè¿”å›401é”™è¯¯ï¼Ÿ
A: è¿™é€šå¸¸è¡¨ç¤ºè®¤è¯Tokenå·²è¿‡æœŸæˆ–æ— æ•ˆã€‚è¯·é‡æ–°ç™»å½•ã€‚

### Q: å¦‚ä½•æ¢å¤å·²åˆ é™¤çš„å•†å“ï¼Ÿ
A: å·²åˆ é™¤çš„å•†å“ä½¿ç”¨è½¯åˆ é™¤æœºåˆ¶ã€‚ä½¿ç”¨ `POST /api/admin/products/:id/restore` æ¥å£å¯ä»¥æ¢å¤ã€‚

### Q: æ•°æ®ç»Ÿè®¡ä¸å‡†ç¡®ï¼Ÿ
A: è¯·ç¡®ä¿å·²æ­£ç¡®è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ï¼Œå¹¶æ£€æŸ¥ç»Ÿè®¡è§†å›¾æ˜¯å¦åˆ›å»ºæˆåŠŸã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ç®¡ç†å‘˜æƒé™ï¼Ÿ
A: åœ¨ç”¨æˆ·çš„`user_metadata`ä¸­çš„`permissions`æ•°ç»„æ·»åŠ ç›¸åº”æƒé™å³å¯ã€‚

---

## å®‰å…¨å»ºè®®

1. **å®šæœŸæ›´æ¢ç®¡ç†å‘˜å¯†ç **: å»ºè®®æ¯3ä¸ªæœˆæ›´æ¢ä¸€æ¬¡
2. **é™åˆ¶ç®¡ç†å‘˜æ•°é‡**: åªæˆäºˆå¿…è¦äººå‘˜ç®¡ç†å‘˜æƒé™
3. **å®šæœŸæ£€æŸ¥æ“ä½œæ—¥å¿—**: é€šè¿‡`admin_logs`è¡¨æŸ¥çœ‹æ‰€æœ‰ç®¡ç†æ“ä½œ
4. **ä½¿ç”¨å¼ºå¯†ç **: ç¡®ä¿ç®¡ç†å‘˜è´¦å·ä½¿ç”¨å¼ºå¯†ç 
5. **å¯ç”¨2FA**: åœ¨Supabaseä¸­ä¸ºç®¡ç†å‘˜è´¦å·å¯ç”¨ä¸¤æ­¥éªŒè¯

---

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-14)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… ä»ªè¡¨æ¿åŠŸèƒ½
- âœ… å•†å“ç®¡ç†åŠŸèƒ½
- âœ… ç”¨æˆ·ç®¡ç†åŠŸèƒ½
- âœ… æ¶ˆæ¯ç›‘æ§åŠŸèƒ½
- âœ… æ“ä½œæ—¥å¿—åŠŸèƒ½

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒæˆ–æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£ã€‚

**æ–‡æ¡£æ›´æ–°æ—¶é—´**: 2024-01-14
